<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test streams</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="initVideo.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <script src="./Video.js"></script>
</head>
<body>
<div class="Grid">
    <div class="VideoWrapper">
        <div class="Video">
            <canvas id='video-1' class="Video-Box"></canvas>
            <div class="Video-Panel">
                <button class="Button Button-Play">Играть</button>
                <button class="Button Button-Pause">Пауза</button>
                <label class="Input Input-Brightness">Яркость<input value="0" type="range" min="0" max="100"></label>
                <label class="Input Input-Contrast">Контрастность<input value="1" type="range" min="0" max="100"></label>
                <button class="Button BtnAllCameras">Все камеры</button>
            </div>
        </div>
    </div>
    <div class="VideoWrapper">
        <div class="Video">
            <canvas id='video-2' class="Video-Box"></canvas>
            <div class="Video-Panel">
                <button class="Button Button-Play">Играть</button>
                <button class="Button Button-Pause">Пауза</button>
                <label class="Input Input-Brightness">Яркость<input value="0" type="range" min="0" max="100"></label>
                <label class="Input Input-Contrast">Контрастность<input value="1" type="range" min="0" max="100"></label>
                <button class="Button BtnAllCameras">Все камеры</button>
            </div>
        </div>
    </div>
    <div>
        <div class="Video">
            <canvas id='video-3' class="Video-Box"></canvas>
            <div class="Video-Panel">
                <button class="Button Button-Play">Играть</button>
                <button class="Button Button-Pause">Пауза</button>
                <label class="Input Input-Brightness">Яркость<input value="0" type="range" min="0" max="100"></label>
                <label class="Input Input-Contrast">Контрастность<input value="1" type="range" min="0" max="100"></label>
                <button class="Button BtnAllCameras">Все камеры</button>
            </div>
        </div>
    </div>
    <div>
        <div class="Video">
            <canvas id='video-4' class="Video-Box"></canvas>
            <div class="Video-Panel">
                <button class="Button Button-Play">Играть</button>
                <button class="Button Button-Pause">Пауза</button>
                <label class="Input Input-Brightness">Яркость<input value="0" type="range" min="0" max="100"></label>
                <label class="Input Input-Contrast">Контрастность<input value="1" type="range" min="0" max="100"></label>
                <button class="Button BtnAllCameras">Все камеры</button>
            </div>
        </div>
    </div>
</div>
<script>
    
    function createVideoElem(url) {
        const video = document.createElement('video');
        video.autoplay = false;
        video.loop = true;
        video.muted = false;
        initVideo(video, url);
        return video;
    }

    // canvas1.addEventListener('click', () => {
    //     const context = new (window.AudioContext || window.webkitAudioContext)();
    //     const analyser = context.createAnalyser();
    //     analyser.smoothingTimeConstant = 0.3;
    //     analyser.fftSize = 1024;

    //     const source = context.createMediaElementSource(video1);
    //     const processor = context.createScriptProcessor(512, 2, 1);
    //     source.connect(analyser);
    //     analyser.connect(processor);
    //     source.connect(context.destination);
    //     processor.connect(context.destination);
    //     processor.onaudioprocess = (e) => {
    //         const buffer = new Uint8Array(analyser.frequencyBinCount);
    //         const chd = event.inputBuffer.getChannelData(0);
    //         analyser.getByteFrequencyData(buffer);
    //         const average = getAverageVolume(buffer);
    //         console.log('VOLUME:' + average);
    //     }
    // });

    const urls = ['http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fsosed%2Fmaster.m3u8',
        'http://localhost:9191/live?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fstairs%2Fmaster.m3u8',
        'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fdog%2Fmaster.m3u8',
        'http://localhost:9191/live?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fstreet%2Fmaster.m3u8',
    ];

    const videos = document.querySelectorAll('.Video');
    for (let i = 0; i < videos.length; i++) {
        const videoElem = videos[i];
        const video = new Video(videoElem, createVideoElem(urls[i]));
        video.init();
        video.updateCanvas();
    };
</script>


</body>
</html>
